<section id="<%= dom_id(@task) %>" class="task-page" data-controller="task">
  <div class="row">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <div class="d-flex align-items-center">
        <span class="text-muted mr-3">
          <i class="fas fa-check-square mr-1"></i>
          <%= @task.slug.upcase %>
        </span>
        <span class="badge rounded-pill <%= @task.label.color %>"><%= @task.label.name %></span>
      </div>
      <%= link_to 'Back to board', project_path(@project) %>
    </div>
    <div class="col-md-8">
      <header class="task-page__header mb-4">
        <h2 class="font-weight-bold"><%= @task.title %></h2>
      </header>
      <div>
        <%= @task.description %>
      </div>
      <div class="mt-4">
        <h4 class="font-weight-bold mb-3">Comments (<%= @task.comments_count %>)</h4>

        <% if @comment.errors.any? %>
          <ul class="list-group mb-3">
            <% @comment.errors.full_messages.each do |error| %>
              <li class="list-group-item list-group-item-danger"><%= error %></li>
            <% end %>
          </ul>
        <% end %>

        <div>
          <%= render 'comments/form' %>
        </div>
        <div class="mt-3">
          <% if @comments.any? %>
            <div id="task-<%= @task.slug %>-comments">
              <%= render(CommentComponent.with_collection(@comments, current_user: current_user)) %>
            </div>
            <div class="d-flex justify-content-center">
              <%= will_paginate @comments, renderer: WillPaginate::ActionView::BootstrapLinkRenderer %>
            </div>
          <% else %>
            <h5 class="text-center mt-3">Be the first adding a comment! ðŸ˜ƒ</h5>
          <% end %>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="bg-light rounded-lg p-2 mb-3">
        <%= label_tag 'Status', nil, { class: 'form-label font-weight-bold' } %>
        <%= select_tag "status",
              options_from_collection_for_select(@labels, 'slug', 'name', @task.label.slug),
              { class: 'form-select cursor-pointer', data: { action: 'change->task#update_status' } } %>
      </div>
      <div class="task__assignee p-2 mb-3">
        <%= label_tag 'Assignee', nil, { class: 'form-label font-weight-bold' } %>
        <%= select_tag "assignee", options_from_collection_for_select(@members, 'id', 'name', @task.assignee&.id), { include_blank: 'Choose someone', class: 'form-select cursor-pointer', data: { action: 'change->task#update_assignee' }} %>

        <% if @task.assignee %>
          <div class="mt-2">
            <a href="#" class="text-decoration-none">
              <%= render(UserAvatarComponent.new(user: @task.assignee, size: 30)) %>
            </a>
            <span class="ml-1"><%= @task.assignee.name.familiar %></span>
          </div>
        <% end %>
      </div>
      <div class="task__reporter p-2 mb-3">
        <h6 class="font-weight-bold">Reporter</h6>
        <a href="#" class="text-decoration-none">
          <%= render(UserAvatarComponent.new(user: @task.reporter, size: 30)) %>
        </a>
        <span class="ml-1"><%= @task.reporter.name.familiar %></span>
      </div>
      <section class="task__story-points p-2 mb-3">
        <label class="d-flex align-items-center form-label font-weight-bold">
          Story Points
          <span class="badge rounded-pill bg-secondary ml-2"><%= @task.story_points %></span>
        </label>
        <%= number_field_tag 'story_points', @task.story_points, class: 'form-control', min: 1, data: { action: 'change->task#update_story_points' } %>
      </section>
    </div>
  </div>
</section>
